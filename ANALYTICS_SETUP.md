# Настройка аналитики для Telegram Mini App

## Варианты аналитики

### 1. Яндекс.Метрика (рекомендуется для русскоязычных проектов)

**Преимущества:**
- ✅ Хорошо работает в Telegram WebView
- ✅ Подробная статистика по пользователям
- ✅ Вебвизор для записи сессий
- ✅ Бесплатно

**Как настроить:**

1. Зарегистрируйтесь на [Яндекс.Метрика](https://metrika.yandex.ru/)
2. Создайте новый счетчик
3. Выберите тип "Веб-сайт"
4. Укажите URL вашего приложения (например: `https://ivanovsdmitry.github.io/agoracards/`)
5. Скопируйте ID счетчика (например: `12345678`)

6. Откройте файл `index.html` и найдите строку:
   ```javascript
   yandexMetrikaId: null, // Например: 12345678
   ```

7. Замените `null` на ваш ID:
   ```javascript
   yandexMetrikaId: 12345678,
   ```

8. Также раскомментируйте блок Яндекс.Метрики в `<head>` (строки 9-20) и замените `YOUR_COUNTER_ID` на ваш ID.

### 2. Google Analytics 4

**Преимущества:**
- ✅ Мощная аналитика
- ✅ Интеграция с другими сервисами Google
- ✅ Бесплатно

**Как настроить:**

1. Зарегистрируйтесь на [Google Analytics](https://analytics.google.com/)
2. Создайте новое свойство (Property)
3. Выберите тип "Веб"
4. Скопируйте Measurement ID (например: `G-XXXXXXXXXX`)

5. Откройте файл `index.html` и найдите строку:
   ```javascript
   googleAnalyticsId: null, // Например: 'G-XXXXXXXXXX'
   ```

6. Замените `null` на ваш ID:
   ```javascript
   googleAnalyticsId: 'G-XXXXXXXXXX',
   ```

### 3. Комбинированный подход

Можно использовать оба сервиса одновременно:
```javascript
initAnalytics({
    yandexMetrikaId: 12345678,
    googleAnalyticsId: 'G-XXXXXXXXXX'
});
```

## Отслеживаемые события

Система автоматически отслеживает:

1. **Запуск приложения** - `app.start`
2. **Просмотр экранов** - `navigation.screen_view`
3. **Открытие колоды** - `deck.open`
4. **Переворот карты** - `card.flip`
5. **Переключение карты** - `card.change` (previous/next)
6. **Случайная карта** - `card.random`
7. **Пауза/возобновление сессии** - `session.pause/resume`
8. **Завершение сессии** - `session.end` (с длительностью)

## Ручная отправка событий

Вы можете отправлять свои события:

```javascript
// В любом месте кода
if (analytics) {
    analytics.trackEvent('category', 'action', 'label', value);
}

// Примеры:
analytics.trackEvent('button', 'click', 'random_card');
analytics.trackEvent('feature', 'use', 'deck_creation', 1);
```

## Особенности для Telegram Mini App

- Система автоматически определяет, запущено ли приложение в Telegram
- Используется ID пользователя Telegram (если доступен)
- Создается уникальный ID сессии для каждой сессии
- События отправляются с дополнительными параметрами (user_id, session_id, app_type)

## Проверка работы

1. Откройте приложение в Telegram
2. Выполните несколько действий (откройте колоду, переверните карту)
3. Подождите 5-10 минут
4. Проверьте в Яндекс.Метрике или Google Analytics:
   - Реальные посетители
   - События
   - Сессии

## Отладка

В режиме разработки (localhost) все события логируются в консоль браузера.

Откройте консоль (F12) и вы увидите:
```
Analytics Event: {category: 'deck', action: 'open', ...}
```

## Важные замечания

⚠️ **Telegram WebView:**
- Яндекс.Метрика и Google Analytics работают в Telegram WebView
- Некоторые функции (например, вебвизор) могут работать ограниченно
- Cookies могут быть ограничены

⚠️ **GDPR и приватность:**
- Убедитесь, что у вас есть политика конфиденциальности
- Информируйте пользователей о сборе данных
- Для EU пользователей может потребоваться согласие

## Альтернативные решения

Если Яндекс.Метрика или Google Analytics не подходят, можно:

1. **Использовать Telegram Bot API** - отправлять события через вашего бота
2. **Собственный бэкенд** - собирать события на своем сервере
3. **Mixpanel, Amplitude** - специализированные сервисы для мобильных приложений

---

**Готово!** После настройки аналитика начнет работать автоматически.

